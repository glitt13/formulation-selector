'''
@title: A test case for OCONUS/CONUS basins
@author: Guy Litt <guy.litt@noaa.gov>
@description: Read a fake dataset generated by prep_fakebm25_oconus_testing.R
and convert into a standardized form (.nc file) for RaFTS processing
@usage: python proc_xssa_metrics.py "/full/path/to/xssaus_config.yaml"

Changelog/contributions
    2025-04-30 Originally created, GL
'''
import argparse
import pandas as pd
from pathlib import Path
import yaml
from fs_prep.proc_eval_metrics import read_schm_ls_of_dict, proc_col_schema
import numpy as np
import re
if __name__ == "__main__":
    parser = argparse.ArgumentParser(description='Process the YAML config file.')
    parser.add_argument('path_config', type=str, help='Path to the YAML configuration file')
    args = parser.parse_args()
    # The path to the configuration
    home_dir = Path.home()
    path_prep_config = args.path_config.format(home_dir = str(Path.home())) #  Path(f'{home_dir}/git/formulation-selector/scripts/eval_ingest/bm_test25/bm25test_prep_config.yml')

    print("Converting schema to DataFrame")
    # Read in the config file & convert to pd.DataFrame
    col_schema_df = read_schm_ls_of_dict(schema_path = path_prep_config)

    #dir_data = col_schema_df['dir_data'].loc[0].format(home_dir = str(Path.home()))
    dir_save = col_schema_df['dir_save'].loc[0].format(home_dir = str(Path.home()))
    path_data = col_schema_df['path_data'].loc[0].format(home_dir = str(Path.home()))
    # ---------------- BEGIN CUSTOMIZED DATASET MUNGING ----------------
    df_data = pd.read_csv(path_data,dtype={'usgsId':str}).drop(columns=['Unnamed: 0'], axis=1)

    # ----------------- END CUSTOMIZED DATASET MUNGING -----------------
    ds = proc_col_schema(df_data, col_schema_df, dir_save)
